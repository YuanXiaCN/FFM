<template>
  <div id="app" :class="{ 'window-moving': isMoving }">
    <transition name="q-bounce" mode="out-in">
      <div key="$route.fullPath">
        <div class="window-header">
          <div class="window-title"></div>
          <div class="window-controls">
            <div class="account-selector-container">
              <AccountSelector />
            </div>
            <div class="window-buttons">
              <button @click="minimize" title="最小化">
                <svg t="1748895205690" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                  p-id="7284">
                  <path d="M923 571H130.7c-27.6 0-50-22.4-50-50s22.4-50 50-50H923c27.6 0 50 22.4 50 50s-22.4 50-50 50z"
                    p-id="7285"></path>
                </svg>
              </button>

              <button @click="maximize" title="最大化/还原">
                <svg v-if="!isMaximized" t="1748895538325" class="icon" viewBox="0 0 1024 1024" version="1.1"
                  xmlns="http://www.w3.org/2000/svg" p-id="3665">
                  <path
                    d="M459.861333 564.138667a42.666667 42.666667 0 0 1 0 60.330666L230.997333 853.333333H384a42.666667 42.666667 0 0 1 0 85.333334H126.634667l-2.304-0.170667-1.28-0.128-1.578667-0.213333a42.794667 42.794667 0 0 1-0.981333-0.170667L119.466667 937.813333a42.368 42.368 0 0 1-25.173334-15.573333l3.498667 3.925333A43.008 43.008 0 0 1 85.333333 896.853333V640a42.666667 42.666667 0 0 1 85.333334 0v152.917333l228.864-228.778666a42.666667 42.666667 0 0 1 60.330666 0zM896 85.333333h0.853333c0.896 0 1.834667 0.085333 2.730667 0.170667L896 85.333333a43.008 43.008 0 0 1 7.509333 0.682667l0.981334 0.170667a42.368 42.368 0 0 1 17.664 8.106666l0.085333 0.042667 0.426667 0.384c2.56 2.048 4.906667 4.394667 6.912 6.954667l-3.413334-3.84a43.008 43.008 0 0 1 12.458667 28.8v-0.042667L938.666667 128v256a42.666667 42.666667 0 0 1-85.333334 0V230.997333l-228.864 228.864a42.666667 42.666667 0 0 1-60.330666-60.330666L792.917333 170.666667H640a42.666667 42.666667 0 0 1 0-85.333334h256z"
                    p-id="3666"></path>
                </svg>
                <svg v-else t="1748895526530" class="icon" viewBox="0 0 1024 1024" version="1.1"
                  xmlns="http://www.w3.org/2000/svg" p-id="3513">
                  <path
                    d="M426.666667 597.333333h0.810666c0.938667 0 1.877333 0.085333 2.773334 0.170667L426.666667 597.333333a43.008 43.008 0 0 1 7.509333 0.682667l0.981333 0.170667a42.368 42.368 0 0 1 8.746667 2.773333l0.853333 0.384 0.682667 0.341333a42.538667 42.538667 0 0 1 7.381333 4.608l0.085334 0.042667 0.426666 0.384c2.56 2.048 4.906667 4.394667 6.912 6.954667l-3.413333-3.84a43.008 43.008 0 0 1 12.458667 28.757333L469.333333 640v256a42.666667 42.666667 0 0 1-85.333333 0v-153.002667l-228.864 228.864a42.666667 42.666667 0 1 1-60.330667-60.330666L323.584 682.666667H170.666667a42.666667 42.666667 0 0 1 0-85.333334h256zM929.194667 137.472a42.666667 42.666667 0 0 1 0 60.330667L700.330667 426.666667H853.333333a42.666667 42.666667 0 0 1 0 85.333333h-257.408l-2.218666-0.170667-1.365334-0.128-1.578666-0.213333a42.752 42.752 0 0 1-0.938667-0.170667l-0.981333-0.170666a42.368 42.368 0 0 1-25.173334-15.573334l3.498667 3.925334A43.008 43.008 0 0 1 554.666667 470.186667 42.24 42.24 0 0 1 554.666667 469.333333V213.333333a42.666667 42.666667 0 0 1 85.333333 0v152.917334l228.864-228.778667a42.666667 42.666667 0 0 1 60.330667 0z"
                    p-id="3514"></path>
                </svg>
              </button>

              <button @click="close" title="关闭">
                <svg t="1748894421973" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                  p-id="6151">
                  <path
                    d="M572.91974805 512l242.82096754-242.82096757c16.30246778-16.30246778 16.30246778-43.75925563 0-60.91974802-16.30246778-16.30246778-43.75925563-16.30246778-60.91974802 0L512 451.08025195 269.17903243 208.25928441c-16.30246778-16.30246778-43.75925563-16.30246778-60.91974802 0-16.30246778 16.30246778-16.30246778 43.75925563 0 60.91974802L451.08025195 512l-242.82096754 242.82096757c-16.30246778 16.30246778-16.30246778 43.75925563 0 60.91974802 16.30246778 16.30246778 43.75925563 16.30246778 60.91974802 0l242.82096757-242.82096754 242.82096757 242.82096754c16.30246778 16.30246778 43.75925563 16.30246778 60.91974802 0 16.30246778-16.30246778 16.30246778-43.75925563 0-60.91974802L572.91974805 512z"
                    p-id="6152"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <div class="sidebar">
          <div class="sidebar-top">
            <router-link to="/home" class="sidebar-item" active-class="active" title="主页">
              <svg t="1748897226629" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3513"><path d="M929.28 358.656l0.341333 0.426667a42.368 42.368 0 0 1 9.045334 26.282666V853.333333a128 128 0 0 1-128 128H213.333333a128 128 0 0 1-128-128V384.512c0-1.024 0.085333-2.090667 0.170667-3.114667L85.333333 385.365333a43.008 43.008 0 0 1 9.045334-26.325333c2.048-2.56 4.394667-4.906667 6.954666-6.954667l0.426667-0.341333 384-300.032a42.666667 42.666667 0 0 1 52.48 0l384 300.032 0.426667 0.341333c2.474667 1.92 4.693333 4.138667 6.613333 6.570667zM512 139.434667l-341.333333 266.666666V853.333333a42.538667 42.538667 0 0 0 36.864 42.24L213.333333 896l128-0.042667v-382.592a42.666667 42.666667 0 0 1 42.666667-42.666666h256a42.666667 42.666667 0 0 1 42.666667 42.666666v382.592L810.666667 896a42.538667 42.538667 0 0 0 42.24-36.864L853.333333 853.333333V406.144l-341.333333-266.709333z m85.333333 416.597333h-170.666666v339.925333h170.666666v-339.925333z"  p-id="3514"></path></svg>
            </router-link>

            <router-link to="/download" class="sidebar-item" active-class="active" title="下载">
              <svg t="1748985620959" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3819"><path d="M896 597.333333a42.666667 42.666667 0 0 1 42.666667 42.666667v170.666667a128 128 0 0 1-128 128H213.333333a128 128 0 0 1-128-128v-170.666667a42.666667 42.666667 0 0 1 85.333334 0v170.666667a42.538667 42.538667 0 0 0 36.864 42.24L213.333333 853.333333h597.333334a42.538667 42.538667 0 0 0 42.24-36.864L853.333333 810.666667v-170.666667a42.666667 42.666667 0 0 1 42.666667-42.666667zM512 85.333333a42.666667 42.666667 0 0 1 42.666667 42.666667l-0.042667 408.96 138.410667-138.325333a42.666667 42.666667 0 1 1 60.330666 60.330666l-211.2 211.2a42.453333 42.453333 0 0 1-22.613333 11.818667l-5.034667 0.597333h-5.034666a42.496 42.496 0 0 1-27.648-12.373333l-211.2-211.2a42.666667 42.666667 0 1 1 60.330666-60.373333L469.333333 536.917333 469.333333 128a42.666667 42.666667 0 0 1 42.666667-42.666667z"  p-id="3820"></path></svg>
            </router-link>
            <div class="sidebar-item " title="添加">
              <svg t="1748897319872" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3819"><path d="M512 170.666667a42.666667 42.666667 0 0 1 42.666667 42.666666v256h256a42.666667 42.666667 0 0 1 0 85.333334h-256v256a42.666667 42.666667 0 0 1-85.333334 0v-256H213.333333a42.666667 42.666667 0 0 1 0-85.333334h256V213.333333a42.666667 42.666667 0 0 1 42.666667-42.666666z"  p-id="3820"></path></svg>
            </div>
          </div>

          <div class="sidebar-bottom" title="设置">
            <router-link to="/settings" class="sidebar-item" active-class="active">
              <svg t="1748897291673" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3667"><path d="M512 0a128 128 0 0 1 128 128 31.061333 31.061333 0 0 0 52.992 21.973333 128 128 0 0 1 181.034667 180.992A31.061333 31.061333 0 0 0 896 384H896a128 128 0 0 1 0 256 31.061333 31.061333 0 0 0-21.973333 52.992 128 128 0 0 1-174.848 186.794667l-6.144-5.76a31.061333 31.061333 0 0 0-52.650667 17.066666L640 896a128 128 0 0 1-256 0 31.061333 31.061333 0 0 0-49.28-25.173333l-3.754667 3.2a128 128 0 0 1-180.992-180.992 31.061333 31.061333 0 0 0-17.066666-52.650667L128 640a128 128 0 0 1 0-256 31.061333 31.061333 0 0 0 25.173333-49.28l-3.2-3.754667A128 128 0 0 1 324.821333 144.213333l6.144 5.76a31.061333 31.061333 0 0 0 52.650667-17.066666L384 128a128 128 0 0 1 128-128z m0 85.333333a42.538667 42.538667 0 0 0-42.24 36.864L469.333333 128a116.394667 116.394667 0 0 1-198.698666 82.346667v-0.042667l-4.352-3.84a42.538667 42.538667 0 0 0-55.978667 3.84 42.538667 42.538667 0 0 0-3.84 55.978667l3.84 4.352A116.394667 116.394667 0 0 1 128 469.333333l-5.802667 0.426667A42.538667 42.538667 0 0 0 85.333333 512a42.538667 42.538667 0 0 0 36.864 42.24L128 554.666667a116.394667 116.394667 0 0 1 82.346667 198.656h-0.042667l-3.84 4.394666a42.538667 42.538667 0 0 0 3.84 55.978667 42.538667 42.538667 0 0 0 55.978667 3.84l4.352-3.84A116.394667 116.394667 0 0 1 469.333333 896l0.426667 5.802667A42.538667 42.538667 0 0 0 512 938.666667a42.538667 42.538667 0 0 0 42.24-36.864L554.666667 896a116.394667 116.394667 0 0 1 198.698666-82.346667v0.042667l4.352 3.84a42.538667 42.538667 0 0 0 55.978667-3.84 42.538667 42.538667 0 0 0 3.84-55.978667l-3.84-4.352a116.394667 116.394667 0 0 1 73.941333-198.4L896 554.666667l5.802667-0.426667A42.538667 42.538667 0 0 0 938.666667 512a42.538667 42.538667 0 0 0-36.864-42.24L896 469.333333a116.394667 116.394667 0 0 1-88.021333-192.554666l5.717333-6.144 3.84-4.352a42.538667 42.538667 0 0 0-3.84-55.978667 42.538667 42.538667 0 0 0-55.978667-3.84l-4.352 3.84a116.394667 116.394667 0 0 1-198.4-73.941333L554.666667 128l-0.426667-5.802667A42.538667 42.538667 0 0 0 512 85.333333z m0 256a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 85.333334c-23.552 0-44.885333 9.557333-60.330667 25.002666A85.077333 85.077333 0 0 0 426.666667 512c0 23.552 9.557333 44.885333 25.002666 60.330667 15.445333 15.445333 36.778667 25.002667 60.330667 25.002666 23.552 0 44.885333-9.557333 60.330667-25.002666 15.445333-15.445333 25.002667-36.778667 25.002666-60.330667 0-23.552-9.557333-44.885333-25.002666-60.330667A85.077333 85.077333 0 0 0 512 426.666667z"  p-id="3668"></path></svg>
            </router-link>
          </div>
        </div>

        <div class="content">
          <transition name="q-fade-slide" mode="out-in">
            <router-view :key="$route.fullPath" />
          </transition>
        </div>
      </div>
    </transition>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import './assets/settings.css'
import AccountSelector from '@/components/AccountSelector.vue'

const isMaximized = ref(false)
const isMoving = ref(false)

function minimize() {
  console.log('minimize 被调用')
  console.log('window.electronAPI:', window.electronAPI)
  if (window.electronAPI && window.electronAPI.windowMin) {
    window.electronAPI.windowMin()
  } else {
    console.error('electronAPI.windowMin 不可用')
  }
}

function maximize() {
  console.log('maximize 被调用')
  console.log('window.electronAPI:', window.electronAPI)
  if (window.electronAPI && window.electronAPI.windowMax) {
    window.electronAPI.windowMax()
  } else {
    console.error('electronAPI.windowMax 不可用')
  }
}

function close() {
  console.log('close 被调用')
  console.log('window.electronAPI:', window.electronAPI)
  if (window.electronAPI && window.electronAPI.windowClose) {
    window.electronAPI.windowClose()
  } else {
    console.error('electronAPI.windowClose 不可用')
  }
}

onMounted(() => {
  window.electronAPI.onMaximized(() => { isMaximized.value = true })
  window.electronAPI.onUnmaximized(() => { isMaximized.value = false })
  
  // 添加窗口移动事件监听
  window.electronAPI.onWindowMove(() => {
    isMoving.value = true
  })
  window.electronAPI.onWindowMoveEnd(() => {
    isMoving.value = false
  })
})
</script>

<style>
#app {
  height: 100%;
  width: 100%;
}

.account-selector-container {
  display: flex;
  align-items: center;
  margin-right: 15px; /* 与最小化按钮保持一定距离 */
  z-index: 1000;
}

.window-header {
  display: flex;
  align-items: center;
  height: 45px;
  padding: 0 15px;
  -webkit-app-region: drag;
  background-color: var(--bg-secondary);
}

.window-title {
  flex: 1; /* 让标题区域占据中间剩余空间 */
}

.window-controls {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  -webkit-app-region: no-drag;
}

.window-buttons {
  display: flex;
  gap: 10px;
  -webkit-app-region: no-drag;
}

.window-buttons button {
  background: transparent;
  border: none;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 30px;
  height: 30px;
  cursor: pointer;
  border-radius: 4px;
  color: var(--text-secondary);
  padding: 0;
}

.window-buttons button:hover {
  background-color: var(--bg-hover);
  color: var(--text-primary);
}

.window-buttons button:last-child:hover {
  background-color: var(--danger-color);
  color: white;
}

.window-buttons svg {
  width: 16px;
  height: 16px;
}

.q-bounce-enter-active, .q-bounce-leave-active {
  transition: all 0.5s cubic-bezier(0.25, 1.5, 0.5, 1);
}

.q-bounce-enter, .q-bounce-leave-to /* .q-bounce-leave-active in <2.1.0 */ {
  opacity: 0;
  transform: scale(0.9);
}
</style>